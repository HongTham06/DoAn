DROP TABLE PHONGBAN
DROP TABLE NHANVIEN
DROP TABLE DEAN
DROP TABLE PHANCONG
DROP TABLE THANNHAN

CREATE TABLE PHONGBAN
(
	MAPH CHAR(5) NOT NULL,
	TENPH NVARCHAR(30)NOT NULL,
	DIADIEM NVARCHAR(40)
	CONSTRAINT PK_PHONGBAN PRIMARY KEY(MAPH)
)
CREATE TABLE NHANVIEN
(
	MANV CHAR(6) NOT NULL,
	HOTEN NVARCHAR(40)NOT NULL,
	NGAYSINH DATE,
	PHAI NVARCHAR(3),
	DIACHI NVARCHAR(40),
	LUONG MONEY,
	MANQL CHAR(6),
	MAPH CHAR(5),
	CONSTRAINT PK_NHANVIEN PRIMARY KEY(MANV),
	CONSTRAINT FK_NV_PH FOREIGN KEY(MAPH) REFERENCES PHONGBAN(MAPH),
	CONSTRAINT FK_NV_NV FOREIGN KEY(MANQL) REFERENCES NHANVIEN(MANV)
)
CREATE TABLE DEAN
 (
	MADA CHAR(5) NOT NULL,
	TENDA NVARCHAR(50),
	DIADIEMDA NVARCHAR(30),
	NGAYBD DATE,
	CONSTRAINT PK_DEAN PRIMARY KEY (MADA)
 )
  CREATE TABLE PHANCONG
 (
	MANV CHAR(6) NOT NULL,
	MADA CHAR(5) NOT NULL,
	THOIGIAN DATE NOT NULL,
	CONSTRAINT PK_PC PRIMARY KEY (MANV, MADA, THOIGIAN),
	CONSTRAINT FK_PC_NV FOREIGN KEY (MANV) REFERENCES NHANVIEN(MANV),
	CONSTRAINT FK_PC_DA FOREIGN KEY (MADA) REFERENCES DEAN(MADA)
 )
  CREATE TABLE THANNHAN
 (
	MANV CHAR(6) NOT NULL,
	TENTN NVARCHAR(40) NOT NULL,
	PHAI NCHAR(3),
	NGAYSINH DATE,
	QUANHE NVARCHAR(15),
	CONSTRAINT PK_THANNHAN PRIMARY KEY(MANV, TENTN),
	CONSTRAINT FK_TN_NV FOREIGN KEY(MANV) REFERENCES NHANVIEN(MANV),
 )
 INSERT INTO PHONGBAN VALUES ('PH001', N'Kế hoạch', N'Tầng 1 Nhà A');
INSERT INTO PHONGBAN VALUES ('PH002', N'Quản trị', N'Tầng 1 Nhà B');
INSERT INTO PHONGBAN VALUES ('PH003', N'Nhân sự', N'Tầng 2 Nhà A');
INSERT INTO PHONGBAN VALUES ('PH004', N'Tài vụ', N'Tầng 3 Nhà A');
INSERT INTO PHONGBAN VALUES ('PH005', N'Đầu tư', N'Tầng 2 Nhà B');
INSERT INTO PHONGBAN VALUES ('PH006', N'Vật tư', N'Tầng 3 Nhà B');
INSERT INTO PHONGBAN VALUES ('PH007', N'Tư vấn', N'Tầng 3 Nhà B');

SET DATEFORMAT DMY;
INSERT INTO NHANVIEN VALUES ('NV0001',N'Nguyễn Văn Nam','12/07/1988',N'Nam',N'Tây Ninh',15000000,'NV0009','PH003');
INSERT INTO NHANVIEN VALUES ('NV0002',N'Nguyễn Kim Ánh','10/02/1990',N'Nữ',N'TP. HCM',8000000,'NV0009','PH003');
INSERT INTO NHANVIEN VALUES ('NV0003',N'Nguyễn Thị Châu','12/10/1979',N'Nữ',N'Vũng Tàu',12000000,'NV0006','PH003');
INSERT INTO NHANVIEN VALUES ('NV0004',N'Trần Văn Út','23/08/1977',N'Nam', N'Hà Nội',7000000,'NV0005','PH002');
INSERT INTO NHANVIEN VALUES ('NV0005',N'Trần Lệ Quyên','22/11/1987',N'Nữ',N'Hà Nội',9000000,'NV0005','PH002');
INSERT INTO NHANVIEN VALUES ('NV0006',N'Bùi Đức Chí','22/11/1987',N'Nam',N'TP. HCM',10000000,'NV0008','PH003');
INSERT INTO NHANVIEN VALUES ('NV0007',N'Nguyễn Tuấn Anh','06/09/1991',N'Nam',N'Tây Ninh',30500000,'NV0002','PH003');
INSERT INTO NHANVIEN VALUES ('NV0008',N'Đỗ Xuân Thủy','14/05/1985',N'Nam',N'TP. HCM',21000000,'NV0002','PH002');
INSERT INTO NHANVIEN VALUES ('NV0009',N'Trần Minh Tú','17/09/1985',N'Nam',N'Đồng Nai',18000000,NULL,'PH001');


SET DATEFORMAT DMY;
INSERT INTO DEAN VALUES ('DA001', N'Đền bù giải tỏa', N'Phường 12, Q. Tân Bình', '01/01/2015')
INSERT INTO DEAN VALUES ('DA002', N'Giải phóng mặt bằng', N'Phường 12, Q. Tân Bình', '01/06/2015')
INSERT INTO DEAN VALUES ('DA003', N'Cải tạo mặt đường số 9', N'Phường Tây Thạnh, Q. Tân Phú', '01/01/2016')
INSERT INTO DEAN VALUES ('DA004', N'Bắt đầu thi công', N'Phường 26, Q. Bình Thạnh', '04/05/2016')
INSERT INTO DEAN VALUES ('DA005', N'Hoàn thiện mặt bằng', N'Phường Tân Quy, Quận 7', '10/12/2016')
SET DATEFORMAT DMY;
INSERT INTO PHANCONG VALUES ('NV0001', 'DA001', '05/02/2015')
INSERT INTO PHANCONG VALUES ('NV0001', 'DA003', '17/03/2016')
INSERT INTO PHANCONG VALUES ('NV0003', 'DA003', '01/01/2016')
INSERT INTO PHANCONG VALUES ('NV0005', 'DA004', '10/05/2016')
INSERT INTO PHANCONG VALUES ('NV0007', 'DA005', '20/12/2016')

INSERT INTO THANNHAN VALUES ('NV0001',N'Nguyễn Thị Tám',N'Nữ','05/09/2015','Con');
INSERT INTO THANNHAN VALUES ('NV0001',N'Nguyễn Văn Bình',N'Nam','22/05/1983',N'Anh');
INSERT INTO THANNHAN VALUES ('NV0002',N'Nguyễn Chính Nghĩa',N'Nam','07/03/1998',N'Em');
INSERT INTO THANNHAN VALUES ('NV0005',N'Lê Anh Hùng',N'Nam','05/04/1978',N'Chồng');
INSERT INTO THANNHAN VALUES ('NV0006',N'Bùi Đại An',N'Nam','03/12/1976',N'Anh');
INSERT INTO THANNHAN VALUES ('NV0008',N'Lê Thảo Nguyên',N'Nữ','12/06/1985',N'Vợ');
INSERT INTO THANNHAN VALUES ('NV0009',N'Trần Thanh Nhàn',N'Nữ','30/05/1979',N'Chị');
SELECT *FROM PHONGBAN;
SELECT * FROM NHANVIEN;
SELECT * FROM DEAN;
SELECT * FROM PHANCONG;
SELECT *FROM THANNHAN;
--Cau 3:
SELECT HOTEN
FROM NHANVIEN
WHERE PHAI =N'Nữ' and DIACHI=N'Hà Nội' OR PHAI=N'Nam' and DIACHI=N'TP.HCM'
--cau 4
SELECT MANQL
FROM NHANVIEN
WHERE HOTEN=N'Nguyễn Kim Ánh'
--CAU 5
SELECT MANV,HOTEN
FROM NHANVIEN,PHONGBAN
WHERE NHANVIEN.MAPH=PHONGBAN.MAPH AND TENPH=N'Quản trị'
--cau 6
SELECT MANV,HOTEN,DIACHI
FROM NHANVIEN,PHONGBAN
where NHANVIEN.MAPH=PHONGBAN.MAPH AND TENPH=N'Nhân sự'
--cau 7
SELECT NGAYSINH,DIACHI,TENPH
FROM NHANVIEN,PHONGBAN
WHERE NHANVIEN.MAPH=PHONGBAN.MAPH AND HOTEN=N'Nguyễn Kim Ánh'
--CAU 8
SELECT *
FROM NHANVIEN,PHONGBAN
WHERE NHANVIEN.MAPH=PHONGBAN.MAPH AND (TENPH=N'Quản trị' AND LUONG>=20000000 )OR(TENPH=N'Nhân sự' AND LUONG>=15000000 )
--CAU 9
SELECT COUNT(*)AS SOLUONG
FROM NHANVIEN,PHONGBAN
WHERE NHANVIEN.MAPH=PHONGBAN.MAPH AND TENPH=N'Quản trị'
--cau 10
SELECT HOTEN,TENTN
FROM NHANVIEN,THANNHAN
WHERE NHANVIEN.MANV=THANNHAN.MANV AND (NHANVIEN.PHAI=N'Nữ')
SELECT *
FROM NHANVIEN
SELECT *
FROM THANNHAN

--cau 11
SELECT HOTEN,COUNT(THANNHAN.MANV )AS SOLUONG
FROM NHANVIEN, THANNHAN
GROUP BY HOTEN,THANNHAN.MANV
 
--CAU 12
SELECT TENPH,AVG(LUONG)AS LUONGTB
FROM PHONGBAN,NHANVIEN
WHERE NHANVIEN.MAPH=PHONGBAN.MAPH
GROUP BY TENPH
--CAU 13
SELECT NHANVIEN.MANV,HOTEN
FROM NHANVIEN, THANNHAN
WHERE NHANVIEN.MANV=THANNHAN.MANV
GROUP BY NHANVIEN.MANV,HOTEN
HAVING  COUNT(THANNHAN.TENTN)>=2
--CAU 14
SELECT DISTINCT NHANVIEN.MANV--, HOTEN
FROM NHANVIEN,THANNHAN
WHERE NHANVIEN.MANV NOT IN
(SELECT THANNHAN.MANV
FROM THANNHAN)
--CAU 15 Cho biết mã và họ tên nhân viên có lƣơng thấp nhất.



--cau 18
SELECT NHANVIEN.MANV,HOTEN
FROM NHANVIEN,PHANCONG
WHERE NHANVIEN.MANV=PHANCONG.MANV AND MADA='DA003'AND MADA='DA004'
--2. Tìm những nhân viên (MANV, HOTEN, NGAYSINH, DIACHI, PHAI, LUONG, MANQL, MAPH  có lƣơng trên 10.000.000 đồng.
--3. Cho biết họ tên của những nhân viên nam ở TP. HCM hoặc nhân viên nữ ở Hà Nội.
--4. Cho biết mã ngƣời quản l  của nhân viên Nguyễn Kim Ánh.
--5. Tìm mã và họ tên những nhân viên thuộc ph ng Quản trị.
--6. Liệt kê danh sách gồm mã, họ tên và địa chỉ của những nhân viên thuộc ph ng Nhân sự.
--7. Cho biết ngày sinh, địa chỉ và tên ph ng làm việc của nhân viên Trần Lệ Quyên.
--8. Tìm những nhân viên có lƣơng lớn hơn 15.000.000 đồng ở ph ng Nhân sự hoặc lƣơng lớn hơn 20.000.000 đồng ở ph ng Quản trị. Thông tin bao gồm tất cả các cột trên bảng NHANVIEN.
--9. Ph ng Quản trị có bao nhiêu nhân viên 
--10. Tìm tên những nữ nhân viên và tên ngƣời thân của họ.
--11. Với mỗi nhân viên cho biết họ tên và số ngƣời thân của nhân viên đó.
--12. Với mỗi phòng ban liệt kê tên ph ng ban và lƣơng trung bình của những nhân viên làm việc cho ph ng ban đó.
--13. Cho biết danh sách những nhân viên  MANV, HOTEN  có trên hai thân nhân.
--14. Cho biết danh sách những nhân viên (MANV, HOTEN) không có thân nhân.
--15. Cho biết mã và họ tên nhân viên có lƣơng thấp nhất.
SELECT HOTEN,MANV
FROM NHANVIEN
WHERE LUONG<=ALL(SELECT LUONG
FROM NHANVIEN
)

SELECT TOP 1 HOTEN,MANV
FROM NHANVIEN
ORDER BY LUONG ASC
--16. Cho biết mã và họ tên nhân viên có lƣơng cao nhất ph ng Nhân sự.
SELECT MANV
FROM NHANVIEN,PHONGBAN
WHERE NHANVIEN.MAPH=PHONGBAN.MAPH AND TENPH=N'Nhân sự' AND LUONG>=ALL(SELECT LUONG
FROM NHANVIEN,PHONGBAN
)

--17. Cho biết tên những đề án có ít nhất hai nhân viên tham gia.
SELECT TENDA
FROM NHANVIEN,DEAN,PHANCONG
WHERE NHANVIEN.MANV=PHANCONG.MANV AND PHANCONG.MADA=DEAN.MADA
GROUP BY TENDA
HAVING COUNT(PHANCONG.MANV)>=2
--18. Những nhân viên nào  MANV, HOTEN  tham gia cả hai đề án DA003 và DA004?
SELECT NHANVIEN.MANV,NHANVIEN.HOTEN
FROM NHANVIEN,PHANCONG
WHERE NHANVIEN.MANV=PHANCONG.MANV AND MADA='DA003' AND MADA='DA004'
--19. Những nhân viên nào  HOTEN  có lƣơng lớn hơn lƣơng cao nhất của các nhân viên ph ng Quản trị?
SELECT HOTEN
FROM NHANVIEN
WHERE LUONG>ALL(SELECT LUONG
FROM NHANVIEN,PHONGBAN
WHERE NHANVIEN.MAPH=PHONGBAN.MAPH AND TENPH=N'Quản trị'
)
--20. Ph ng ban nào có số nhân viên nhiều hơn số nhân viên của ph ng Kế hoạch?
Select TENPH,NHANVIEN.MAPH
From NHANVIEN , PHONGBAN 
Where NHANVIEN.MAPH=PHONGBAN.MAPH
Group by  TENPH,NHANVIEN.MAPH
Having COUNT(MANV)>(Select COUNT(MANV) 
From NHANVIEN , PHONGBAN 
 Where NHANVIEN.MAPH=PHONGBAN.MAPH and PHONGBAN.TENPH=N'Kế hoạch')
--21. Liệt kê ba nhân viên  MANV, HOTEN  có mức lƣơng cao nhất
SELECT TOP 3 MANV
FROM NHANVIEN
ORDER BY LUONG DESC
--22. Cập nhật tăng 10  lƣơng cho những nhân viên đã từng tham gia ít nhất hai đề án.

--23. Cho biết mã và họ tên những nhân viên tham gia tất cả các đề án.
SELECT NHANVIEN.MANV,COUNT(*)as soluong
FROM NHANVIEN,PHANCONG
WHERE NHANVIEN.MANV=PHANCONG.MANV
GROUP BY NHANVIEN.MANV
HAVING COUNT(*)=(
SELECT COUNT(*)
FROM DEAN)
--24. Có bao nhiêu đề án bắt đầu từ ngày 01/01/2016?
SELECT MADA,TENDA
FROM DEAN
WHERE NGAYBD='01/01/2016'
--25. Tầng 1 nhà A có bao nhiêu phòng ban?
SELECT COUNT(*)as soluong
FROM PHONGBAN
WHERE DIADIEM=N'Tầng 1 nhà A'

